<div class="container">
  <%= form_with url: users_path, method: :get, class: "d-flex mt-2" do %>
    <%= text_field_tag :query,
    params[:query],
    class: "form-control",
    placeholder: "Find a friend"
  %>
    <%= submit_tag "Search", class: "btn btn-primary" %>
  <% end %>
  <% if @users.empty? %>
    <br>
  <% else %>
    <% @users.each do |user| %>
      <div data-controller="add-friendship">
        <ul>
          <%# if user is part of @friends then show checkmark, otherwise show add friend %>
          <%= simple_form_for([user, @friendship],
                  data: {
                    add_friendship_target: "form",
                        action: "submit->add-friendship#send"
                    }) do |f| %>
            <div class="add-friend-profile d-flex mt-3 m-1 mr-5">
              <% if user.photo.attached? %>
                <%= cl_image_tag user.photo.key, class:"avatar-leaderboard" %>
              <% else %>
                <%= image_tag("https://res.cloudinary.com/dvvbk1j65/image/upload/v1679233516/download_riwhuo.png", class:"avatar-leaderboard") %>
              <% end %>
              <h3 class="add-friend-profile-username mt-3"><span><%= user.username %></span></h3>
            </div>
            <%= f.submit "Add Friend" %>
          <% end %>
          <div data-add-friendship-target="result">
          </div>
        </ul>
      </div>
    <% end %>
  <% end %>
  <br>
  <h3>Friend Requests</h3>
  <% @pending_friendships.each do |friendship|  %>
    <% if friendship.asker.photo.attached? %>
      <%= cl_image_tag friendship.asker.photo.key, class:"avatar-leaderboard" %>
    <% else %>
      <%= image_tag("https://res.cloudinary.com/dvvbk1j65/image/upload/v1679233516/download_riwhuo.png", class:"avatar-leaderboard") %>
    <% end %>
    <%= friendship.asker.username %>
    <%= link_to "Accept", friendship_path(friendship), data: {turbo_method: :patch}, class:"accept-btn"%>
    <%= link_to "Delete", friendship_path(friendship), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"},class:"delete-btn" %>
    <br>
    <br>
    <% end %>
  </div>
</div>
